<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>gametime.hpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
/*
    Project: Wolf Engine. Copyright Â© 2014-2022 Pooya Eimandar
    https://github.com/WolfEngine/WolfEngine
*/

#ifdef WOLF_TESTS

#pragma once

#include &lt;wolf.hpp&gt;
#include &lt;system/w_leak_detector.hpp&gt;
#include &lt;boost/test/included/unit_test.hpp&gt;

#include &lt;system/w_gametime.hpp&gt;

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(fixed_time) {
  const wolf::system::w_leak_detector _detector = {};</span>
  using w_gametime = wolf::system::w_gametime;

<span style = "background-color:#dfd">  std::once_flag _flag;
  bool _ticked = false;</span>

<span style = "background-color:#dfd">  constexpr double _stop_after_secs = 3.0;
  constexpr double _target_elapsed_secs = 1.0 / 50.0; // 50 fps</span>

<span style = "background-color:#dfd">  auto _gametime = w_gametime();
  _gametime.reset();
  _gametime.set_fixed_time_step(true);
  _gametime.set_target_elapsed_secs(_target_elapsed_secs);</span>

<span style = "background-color:#dfd">  auto _total_seconds = _gametime.get_total_secs();</span>
#ifdef __clang__
#pragma unroll
#endif
<span style = "background-color:#dfd">  while (_total_seconds &lt; _stop_after_secs) {
    _gametime.tick([&amp;]() { std::call_once(_flag, [&amp;]() { _ticked = true; }); });</span>

<span style = "background-color:#dfd">    _total_seconds = _gametime.get_total_secs();
  }</span>

<span style = "background-color:#dfd">  BOOST_REQUIRE(_ticked == true);
}</span>

<span style = "background-color:#dfd">BOOST_AUTO_TEST_CASE(unfixed_time) {
  const wolf::system::w_leak_detector _detector = {};</span>

<span style = "background-color:#dfd">  constexpr double _stop_after_secs = 5.0;
  constexpr double _target_elapsed_secs = 1.0 / 50.0; // 50 fps</span>

  using w_gametime = wolf::system::w_gametime;

<span style = "background-color:#dfd">  auto _gametime = w_gametime();
  _gametime.reset();
  _gametime.set_fixed_time_step(false);
  _gametime.set_target_elapsed_secs(_target_elapsed_secs);</span>

<span style = "background-color:#dfd">  BOOST_REQUIRE(_gametime.get_fps() == 0);</span>

<span style = "background-color:#dfd">  auto _total_seconds = _gametime.get_total_secs();
  while (_gametime.get_total_secs() &lt; _stop_after_secs) {
    _gametime.tick();
    _total_seconds = _gametime.get_total_secs();
  }</span>

<span style = "background-color:#dfd">  BOOST_REQUIRE(_gametime.get_fps() &gt;= 30);
}</span>

#endif // WOLF_TESTS</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>
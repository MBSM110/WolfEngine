<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>w_encoder.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
ï»¿#ifdef WOLF_MEDIA_FFMPEG

#include "w_encoder.hpp"

using w_encoder = wolf::media::ffmpeg::w_encoder;
using w_av_packet = wolf::media::ffmpeg::w_av_packet;

boost::leaf::result&lt;int&gt;
w_encoder::start(_In_ const w_av_frame &amp;p_frame,
<span style = "background-color:#fdd">                 _Inout_ w_av_packet &amp;p_packet) noexcept {</span>

<span style = "background-color:#fdd">  av_packet_unref(p_packet._packet);
  p_packet._packet-&gt;data = nullptr;
  p_packet._packet-&gt;size = 0;</span>

<span style = "background-color:#fdd">  auto _ret = avcodec_send_frame(this-&gt;ctx.codec_ctx, p_frame._av_frame);
  if (_ret &lt; 0) {
    return W_ERR(std::errc::operation_canceled,</span>
                 "failed to send the avframe for encoding because " +
                     w_ffmpeg_ctx::get_av_error_str(_ret));
  }

<span style = "background-color:#fdd">  _ret = avcodec_receive_packet(this-&gt;ctx.codec_ctx, p_packet._packet);
  if (_ret == AVERROR(EAGAIN) || _ret == AVERROR_EOF) {
    return 0;</span>
  }

<span style = "background-color:#fdd">  if (_ret &lt; 0) {
    return W_ERR(std::errc::operation_canceled,</span>
                 "error happened during the encoding because " +
                     w_ffmpeg_ctx::get_av_error_str(_ret));
  }

<span style = "background-color:#fdd">  return p_packet._packet-&gt;size;
}</span>

#endif // WOLF_MEDIA_FFMPEG</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>